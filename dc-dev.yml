version: '3.8'

services:
  api:
    build:
      target: api-deps
    volumes:
      - ./packages/api:/srv/packages/api
      - /srv/packages/api/node_modules
    environment:
      - NODE_ENV=development
    user: node
    command: yarn dev-api

  assets:
    build:
      target: assets-deps
    volumes:
      - ./packages/assets:/srv/packages/assets
      - /srv/packages/assets/node_modules
    environment:
      - NODE_ENV=development
    user: node
    command: yarn dev-assets

  board:
    build:
      target: board-deps
    volumes:
      - ./packages/board:/srv/packages/board
      - /srv/packages/board/node_modules
    environment:
      - VITE_SERVER_HMR_HOST=board.svg24.dev
      - VITE_SERVER_HMR_PATH=wss
      - VITE_SERVER_HMR_PORT=443
      - VITE_SERVER_HMR_PROTOCOL=wss
      - VITE_SERVER_HOST=0.0.0.0
      - VITE_SERVER_PORT=3000
      - NODE_ENV=development
    user: node
    command: yarn dev-board

  www:
    build:
      target: www-deps
    volumes:
      - ./packages/www:/srv/packages/www
      - /srv/packages/www/node_modules
    environment:
      - NODE_ENV=development
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=3000
    user: node
    command: yarn dev-www

  nginx:
    build:
      target: nginx-dev
